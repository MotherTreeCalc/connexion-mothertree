<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Huiles : Tableau s√©curis√©</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 40px; }
    table { margin: 20px auto; border-collapse: collapse; width: 95%; }
    th, td { padding: 10px; border: 1px solid #ccc; }
    th { background: #f0f0f0; font-weight: bold; }
    .success { color: green; }
    .error { color: crimson; }
    .controls { margin-top: 30px; }
    button, a { margin: 10px; font-size: 16px; padding: 10px 20px; }
    a { text-decoration: none; color: #2c3e50; }
  </style>
</head>
<body>
  <h1>üß™ Huiles : Tableau s√©curis√©</h1>
  <p id="status">V√©rification de la session...</p>

  <table id="dataTable" style="display: none;">
    <thead>
      <tr>
        <th>Nom</th>
        <th>INCI</th>
        <th>Origine</th>
        <th>Type</th>
        <th>Raret√©</th>
        <th>Co√ªt</th>
        <th>Cr√©√©e le</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <div class="controls">
    <button id="logoutBtn">üîí D√©connexion</button>
    <a href="index.html">üè° Retour √† l'accueil</a>
  </div>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

    const supabase = createClient(
      "https://vwxjpuqymhsevwarrrea.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ3eGpwdXF5bWhzZXZ3YXJycmVhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgxMjc1ODgsImV4cCI6MjA2MzcwMzU4OH0.PMoWITQhgpF0B0AA4Q1lTYGJRxRhZNljk2LTkuwznxw"
    );

    const { data: { session } } = await supabase.auth.getSession();

    const status = document.getElementById("status");
    const table = document.getElementById("dataTable");
    const tbody = document.getElementById("tableBody");

    if (!session || !session.user) {
      status.textContent = "‚ùå Utilisateur non connect√©.";
      status.className = "error";
    } else {
      status.innerHTML = `‚úÖ Connect√© en tant que <b>${session.user.email}</b>`;
      status.className = "success";

      const { data, error } = await supabase
        .from("huiles_identite")
        .select("*")
        .order("id");

      if (error) {
        tbody.innerHTML = `<tr><td colspan="7" class="error">Erreur : ${error.message}</td></tr>`;
      } else if (data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="7">Aucune donn√©e disponible.</td></tr>`;
      } else {
        data.forEach(h => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${h.nom}</td>
            <td>${h.inci}</td>
            <td>${h.origine}</td>
            <td>${h.type}</td>
            <td>${h.rarete}</td>
            <td>${h.cout}</td>
            <td>${new Date(h.created_at).toLocaleDateString()}</td>
          `;
          tbody.appendChild(row);
        });
        table.style.display = "table";
      }
    }

    document.getElementById("logoutBtn").addEventListener("click", async () => {
      await supabase.auth.signOut();
      location.reload();
    });
  </script>
</body>
</html>
